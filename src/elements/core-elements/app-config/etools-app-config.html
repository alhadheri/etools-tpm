<!--
App global configuration
-->
<!--import [polymer, etools-dexiejs, lodash]-->

<script>
    'use strict';


    var etoolsCustomDexieDb = new Dexie('TPM');
    etoolsCustomDexieDb.version(1).stores({
        collectionsList: '&name, expire',
        partners: 'id, name, vendor_number, country',
        trips: 'id, name, vendor_number, location, focal_point, status',
        profile: 'id'
    });


    var etoolsAppConfig = {

        // app endpoints
        endpoints: {
            partnerDetails: {
                template: '/api/tpm/partners/<%=id%>'
            },
            visitInfo: {
                template: '/tpm/data/visit-info.json?id="<%=id%>"'
            },
            userProfile: {
                url: '/tpm/data/user-profile.json',
//                exp: 30 * 60 * 1000, // 30min
                cachingKey: 'userData'
            },
            countries: {
                url: '/tpm/data/countries.json',
                exp: 6 * 60 * 60 * 1000, // 6h
                cachingKey: 'countries'
            },
            partnersList: {
                url: '/api/tpm/partners/',
                exp: 1 * 60 * 1000, // 6h
                cachingKey: 'partners'
            },
            tripsList: {
                url: '/tpm/data/trips-list.json',
                exp: 6 * 60 * 60 * 1000, // 6h
                cachingKey: 'trips'
            }
        },
        localEndpoints: {
            partnerDetails: {
                template: '/data/partner-details.json?id="<%=id%>"'
            },
            visitInfo: {
                template: '/data/visit-info.json?id="<%=id%>"'
            },
            userProfile: {
                url: '/data/user-profile.json',
//                exp: 30 * 60 * 1000, // 30min
                cachingKey: 'userData'
            },
            countries: {
                url: '/data/countries.json',
                exp: 6 * 60 * 60 * 1000, // 6h
                cachingKey: 'countries'
            },
            partnersList: {
                url: '/data/partners-list.json',
                exp: 6 * 60 * 60 * 1000, // 6h
                cachingKey: 'partners'
            },
            tripsList: {
                url: '/data/trips-list.json',
                exp: 6 * 60 * 60 * 1000, // 6h
                cachingKey: 'trips'
            }
        },

        globals: {
            // globals


            baseSite: window.location.origin,
            basePath: (window.location.port === '8080') ? '/' : '/tpm/',
            serverBackend: (window.location.port !== '8080'),
            epsPath: (window.location.port !== '8080') ? 'endpoints' : 'localEndpoints',

            // dexie js
            appDexieDb: etoolsCustomDexieDb,

            getEndpoint: function (endpointName, data) {
                var endpoint = etoolsAppConfig[etoolsAppConfig.globals.epsPath][endpointName];
                if (endpoint && endpoint.hasOwnProperty('template') && endpoint.template !== '') {
                    endpoint.url = this.baseSite + _.template(endpoint.template)(data);
                }
                return _.clone(endpoint);
            },

            getPermissionsList: function (userType) {
                return etoolsAppConfig.permissions[`${userType}Permissions`];
            },

            getAbsolutePath: function(path) {
                path = path || '';
                return this.basePath + path;
            }
        },

        // permissions
        permissions: {
            superPermissions: [
                'viewPartnersList',
                'viewPartnersDetails',
                'addNewPartner',
                'editPartnerDetails',
                'viewPartnerAttachments',
                'downloadPartnerAttachments',
                'editPartnerAttachments'
            ], //for testing
            unicefUserPermissions: [
                'viewPartnersList',
                'viewPartnersDetails',
                'viewPartnerAttachments'
            ],
            unicefFpPermissions: [],
            pmePermissions: [],
            tpmPermissions: [
                'viewPartnersDetails',
                'viewPartnerAttachments',
                'downloadPartnerAttachments'
            ]
        }

    };

</script>
