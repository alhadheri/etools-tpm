<!--import [polymer, etools-content-panel, app-route, paper-tabs, app-layout]-->
<!--import [module-styles, shared-styles, partner-actions-tab, app-main-header, search-and-filter,
            partner-details-tab, partner-staff-members-tab, file-attachments-tab, permission-controller,
            update-partner-details-data]-->

<dom-module id="partner-info-view-main">
    <template>
        <!-- inject styles './partner-info-view-main.scss'-->
        <style include="shared-styles module-styles">
            .view-container {
                display: flex;
                padding: 15px;
            }
        </style>
        <app-route
                route="{{route}}"
                pattern="/:tab"
                data="{{routeData}}"></app-route>

        <update-partner-details-data new-partner-details="{{newPartnerDetails}}"></update-partner-details-data>

        <app-header-layout>


            <app-header id="header" fixed shadow>
                <app-main-header></app-main-header>
            </app-header>

            <pages-header-element show-export-button
                                  title="[[partner.name]]"></pages-header-element>
            <div class="tab-selector">
                <paper-tabs attr-for-selected="name" noink="" bottom-item="" role="tablist" tabindex="0" selected="{{routeData.tab}}">
                    <paper-tab name="details" class="details-tab"><span class="tab-content">Partner details</span></paper-tab>
                    <paper-tab name="attachments" class="attachments-tab"><span class="tab-content">Attachments</span></paper-tab>
                </paper-tabs>
            </div>
            <div class="view-container">
                <div id="pageContent">
                    <iron-pages id="info-tabs"
                                selected="{{routeData.tab}}"
                                attr-for-selected="name">

                        <div name="details">
                            <partner-details-tab id="partner-details" partner="[[partner]]" edit-mode="[[_allowEdit()]]"></partner-details-tab>

                            <etools-content-panel title$="Staff Members ([[partner.staff_members.length]])" show-expand-btn>
                                <partner-staff-members-tab id="staff-members"  data-items="{{partner.staff_members}}" edit-mode="[[_allowEdit()]]"></partner-staff-members-tab>
                            </etools-content-panel>
                        </div>

                        <div name="attachments">
                            <file-attachments-tab title="Files"
                                                  allow-download="[[_allowDownload()]]"
                                                  allow-delete
                                                  file-types="[[fileTypes]]"
                                                  files="{{partner.attachments}}"
                                                  readonly="[[!_allowEdit()]]"></file-attachments-tab>
                        </div>

                    </iron-pages>


                </div>

               <template is="dom-if" if="[[_allowEdit()]]" restamp>
                   <div id="sidebar">
                       <partner-actions-tab partner-saved="{{partnerSaved}}"
                                            partner-saving-error="{{partnerSavingError}}" loading="{{updatingInProcess}}"></partner-actions-tab>
                   </div>
               </template>
            </div>

        </app-header-layout>


    </template>

    <!-- inject scripts './partner-info-view-main.js'-->
</dom-module>