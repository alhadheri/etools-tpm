<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../bower_components/web-component-tester/browser.js"></script>

    <!--import [etools-file-element]-->
</head>
<body>

<test-fixture id="etools-file-element-fixture">
    <template>
        <etools-file-element></etools-file-element>
    </template>
</test-fixture>

<script>
    suite('<etools-file-element>', function () {
        var myEl;
        setup(function () {
            myEl = fixture('etools-file-element-fixture');
        });

        suite('_showFileType', function () {
            test('returns true when fileTypesLength > 0, readonly is false and activateFileTypes is true', function () {
                myEl.setAttribute('activate-file-types', true);
                assert.equal(myEl._showFileType(1, false), true);
            });

            test('returns false when fileTypesLength === 0', function () {
                myEl.setAttribute('activate-file-types', true);
                assert.equal(myEl._showFileType(0, false), false);
            });

            test('returns false when readonly is true', function () {
                myEl.setAttribute('activate-file-types', true);
                assert.equal(myEl._showFileType(1, true), false);
            });

            test('returns false when activateFileTypes is false', function () {
                myEl.removeAttribute('activate-file-types');
                assert.equal(myEl._showFileType(1, false), false);
            });
        });

        suite('_showReadonlyType', function () {
            test('returns true when readonly and activateFileTypes is true', function () {
                myEl.setAttribute('activate-file-types', true);
                assert.equal(myEl._showReadonlyType(true), true);
            });

            test('returns false when readonly is false', function () {
                myEl.setAttribute('activate-file-types', true);
                assert.equal(myEl._showReadonlyType(false), false);
            });

            test('returns false when activateFileTypes is false', function () {
                myEl.removeAttribute('activate-file-types');
                assert.equal(myEl._showReadonlyType(true), false);
            });
        });

        suite('_getFileTypeStr', function () {
            setup(function () {
                var fileTypes = [
                    {id: '1', name: 'Training materials'},
                    {id: '2', name: 'ToRs'},
                    {id: '3', name: 'Other'}
                ];
                myEl.fileTypes = fileTypes;
            });

            test('returns null when fileTypes Array is empty', function () {
                myEl.fileTypes = [];
                assert.isNull(myEl._getFileTypeStr('1'));
            });

            test('returns null when fileType is not found', function () {
                assert.isNull(myEl._getFileTypeStr('4'));
            });

            test('returns type name', function () {
                assert.equal(myEl._getFileTypeStr('3'), myEl.fileTypes[2].name);
            });
        });

        suite('_showLabel', function () {
            test('returns true when label is not empty String', function () {
                assert.equal(myEl._showLabel('label'), true);
            });

            test('returns false when label is empty String', function () {
                assert.equal(myEl._showLabel(''), false);
            });

            test('returns false when label is not String', function () {
                assert.equal(myEl._showLabel(null), false);
            });
        });

        suite('_showUploadBtn', function () {
            test('returns true when readonly = false, multiple = true and filesLength >= 0', function () {
                myEl.setAttribute('multiple', true);
                assert.equal(myEl._showUploadBtn(0, false), true);
                assert.equal(myEl._showUploadBtn(1, false), true);
                assert.equal(myEl._showUploadBtn(2, false), true);
            });

            test('returns true when readonly = false, multiple = false and filesLength = 0', function () {
                myEl.removeAttribute('multiple');
                assert.equal(myEl._showUploadBtn(0, false), true);
            });

            test('returns false when readonly = false, multiple = false and filesLength > 0', function () {
                myEl.removeAttribute('multiple');
                assert.equal(myEl._showUploadBtn(1, false), false);
            });

            test('returns false when readonly = true', function () {
                assert.equal(myEl._showUploadBtn(1, true), false);
            });
        });

        suite('_showNoFileAttachedMsg', function () {
            test('returns true when filesLength = 0 and readonly = true', function () {
                assert.equal(myEl._showNoFileAttachedMsg(0, true), true);
            });

            test('returns false when filesLength != 0 or readonly = false', function () {
                assert.equal(myEl._showNoFileAttachedMsg(0, false), false);
                assert.equal(myEl._showNoFileAttachedMsg(1, false), false);
                assert.equal(myEl._showNoFileAttachedMsg(1, true), false);
            });
        });

        suite('_showDownloadBtn', function () {
            test('returns true when file has an URL and allowDownload = true', function () {
                var file = {file_name: 'name', type: '1', attachment_file: 'url'};
                assert.equal(myEl._showDownloadBtn(file, true), true);
            });

            test('returns true when file has a File object and allowDownload = true', function () {
                var file = {file_name: 'name'};
                file.raw = new File([''], 'name');
                assert.equal(myEl._showDownloadBtn(file, true), true);
            });

            test('returns false when allowDownload = false', function () {
                var file = {file_name: 'name', type: '1', attachment_file: 'url'};
                assert.equal(myEl._showDownloadBtn(file, false), false);
            });

            test('returns false when URL or File object is not defined', function () {
                var file = {file_name: 'name', type: '1'};
                assert.equal(myEl._showDownloadBtn(file, true), false);
            });
        });

        suite('_showChangeBtn', function () {
            test('returns true when file is defined, allowChange = true and readonly = false', function () {
                assert.equal(myEl._showChangeBtn({}, true, false), true);
            });

            test('returns false when file is not defined', function () {
                assert.equal(myEl._showChangeBtn(null, true, false), false);
            });

            test('returns false when allowChange = false', function () {
                assert.equal(myEl._showChangeBtn({}, false, false), false);
            });

            test('returns false when readonly = true', function () {
                assert.equal(myEl._showChangeBtn({}, true, true), false);
            });
        });

        suite('_showDeleteBtn', function () {
            test('returns true when file is defined, allowDelete = true and readonly = false', function () {
                assert.equal(myEl._showDeleteBtn({}, true, false), true);
            });

            test('returns false when file is not defined', function () {
                assert.equal(myEl._showDeleteBtn(null, true, false), false);
            });

            test('returns false when allowDelete = false', function () {
                assert.equal(myEl._showDeleteBtn({}, false, false), false);
            });

            test('returns false when readonly = true', function () {
                assert.equal(myEl._showDeleteBtn({}, true, true), false);
            });
        });

        suite('_getFileSelectedClass', function () {
            test('returns "" when file has an URL and allowDownload = true', function () {
                var file = {file_name: 'name', type: '1', attachment_file: 'url'};
                assert.equal(myEl._getFileSelectedClass(file, true), '');
            });

            test('returns "" when file has a File object and allowDownload = true', function () {
                var file = {file_name: 'name'};
                file.raw = new File([''], 'name');
                assert.equal(myEl._getFileSelectedClass(file, true), '');
            });

            test('returns "only-selected" when allowDownload = false', function () {
                var file = {file_name: 'name', type: '1', attachment_file: 'url'};
                assert.equal(myEl._getFileSelectedClass(file, false), 'only-selected');
            });

            test('returns "only-selected" when URL or File object is not defined', function () {
                var file = {file_name: 'name', type: '1'};
                assert.equal(myEl._getFileSelectedClass(file, true), 'only-selected');
            });
        });

        suite('_openFileChooser', function () {
            test('triggers click event on the fileInput', function (done) {

                myEl.$.fileInput.addEventListener('click', function (event) {
                    assert.isDefined(event);
                    done();
                });
                myEl._openFileChooser();
            });
        });

        suite('_replaceFile', function () {
            //..

            test('returns false when changeFileIndex < 0 and resets changeFileIndex', function () {
                var newFile = new File([''], 'name');
                assert.equal(myEl._replaceFile(newFile), false);
                assert.equal(myEl.changeFileIndex, -1);
            });
        });

        suite('', function () {
        });

    });
</script>

</body>
</html>